{"id":"qC9p","dependencies":[{"name":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\package.json","includedInParent":true,"mtime":1662044502394},{"name":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\package.json","includedInParent":true,"mtime":1661947879660},{"name":"websocket","loc":{"line":10,"column":29},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\RealtimeClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\websocket\\lib\\browser.js"},{"name":"./lib/constants","loc":{"line":11,"column":133},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\RealtimeClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\lib\\constants.js"},{"name":"./lib/timer","loc":{"line":12,"column":18},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\RealtimeClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\lib\\timer.js"},{"name":"./lib/serializer","loc":{"line":13,"column":23},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\RealtimeClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\lib\\serializer.js"},{"name":"./RealtimeSubscription","loc":{"line":14,"column":33},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\RealtimeClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\realtime-js\\dist\\module\\RealtimeSubscription.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=require(\"websocket\"),t=require(\"./lib/constants\"),n=r(require(\"./lib/timer\")),s=r(require(\"./lib/serializer\")),i=r(require(\"./RealtimeSubscription\"));function r(e){return e&&e.__esModule?e:{default:e}}var o=function(e,t,n,s){return new(n||(n=Promise))(function(i,r){function o(e){try{h(s.next(e))}catch(t){r(t)}}function a(e){try{h(s.throw(e))}catch(t){r(t)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}h((s=s.apply(e,t||[])).next())})};const a=()=>{};class h{constructor(i,r){this.accessToken=null,this.channels=[],this.endPoint=\"\",this.headers=t.DEFAULT_HEADERS,this.params={},this.timeout=t.DEFAULT_TIMEOUT,this.transport=e.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=a,this.conn=null,this.sendBuffer=[],this.serializer=new s.default,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${i}/${t.TRANSPORTS.websocket}`,(null==r?void 0:r.params)&&(this.params=r.params),(null==r?void 0:r.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),r.headers)),(null==r?void 0:r.timeout)&&(this.timeout=r.timeout),(null==r?void 0:r.logger)&&(this.logger=r.logger),(null==r?void 0:r.transport)&&(this.transport=r.transport),(null==r?void 0:r.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs),(null==r?void 0:r.longpollerTimeout)&&(this.longpollerTimeout=r.longpollerTimeout),this.reconnectAfterMs=(null==r?void 0:r.reconnectAfterMs)?r.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==r?void 0:r.encode)?r.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==r?void 0:r.decode)?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new n.default(()=>o(this,void 0,void 0,function*(){yield this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType=\"arraybuffer\",this.conn.onopen=(()=>this._onConnOpen()),this.conn.onerror=(e=>this._onConnError(e)),this.conn.onmessage=(e=>this.onConnMessage(e)),this.conn.onclose=(e=>this._onConnClose(e))))}disconnect(e,t){return new Promise((n,s)=>{try{this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t||\"\"):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),n({error:null,data:!0})}catch(i){n({error:i,data:!1})}})}log(e,t,n){this.logger(e,t,n)}onOpen(e){this.stateChangeCallbacks.open.push(e)}onClose(e){this.stateChangeCallbacks.close.push(e)}onError(e){this.stateChangeCallbacks.error.push(e)}onMessage(e){this.stateChangeCallbacks.message.push(e)}connectionState(){switch(this.conn&&this.conn.readyState){case t.SOCKET_STATES.connecting:return t.CONNECTION_STATE.Connecting;case t.SOCKET_STATES.open:return t.CONNECTION_STATE.Open;case t.SOCKET_STATES.closing:return t.CONNECTION_STATE.Closing;default:return t.CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===t.CONNECTION_STATE.Open}remove(e){this.channels=this.channels.filter(t=>t.joinRef()!==e.joinRef())}channel(e,t={}){const n=new i.default(e,t,this);return this.channels.push(n),n}push(e){const{topic:t,event:n,payload:s,ref:i}=e;let r=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log(\"push\",`${t} ${n} (${i})`,s),this.isConnected()?r():this.sendBuffer.push(r)}onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:n,payload:s,ref:i}=e;(i&&i===this.pendingHeartbeatRef||n===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log(\"receive\",`${s.status||\"\"} ${t} ${n} ${i&&\"(\"+i+\")\"||\"\"}`,s),this.channels.filter(e=>e.isMember(t)).forEach(e=>e.trigger(n,s,i)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:t.VSN}))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}setAuth(e){this.accessToken=e,this.channels.forEach(n=>{e&&n.updateJoinPayload({user_token:e}),n.joinedOnce&&n.isJoined()&&n.push(t.CHANNEL_EVENTS.access_token,{access_token:e})})}leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t.isJoined()||t.isJoining()));t&&(this.log(\"transport\",`leaving duplicate topic \"${e}\"`),t.unsubscribe())}_onConnOpen(){this.log(\"transport\",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log(\"transport\",\"close\",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log(\"transport\",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e.trigger(t.CHANNEL_EVENTS.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\\?/)?\"&\":\"?\";return`${e}${n}${new URLSearchParams(t)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log(\"transport\",\"heartbeat timeout. Attempting to re-establish connection\"),void(null===(e=this.conn)||void 0===e||e.close(t.WS_CLOSE_NORMAL,\"hearbeat timeout\"));this.pendingHeartbeatRef=this.makeRef(),this.push({topic:\"phoenix\",event:\"heartbeat\",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}exports.default=h;"},"sourceMaps":null,"error":null,"hash":"f11dac9613b7cd257fd4aafa0d92df66","cacheData":{"env":{}}}