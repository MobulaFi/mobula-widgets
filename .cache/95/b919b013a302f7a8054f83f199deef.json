{"id":"jRYf","dependencies":[{"name":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\package.json","includedInParent":true,"mtime":1662043584758},{"name":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\package.json","includedInParent":true,"mtime":1661947879682},{"name":"./GoTrueApi","loc":{"line":10,"column":22,"index":703},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\GoTrueClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\GoTrueApi.js"},{"name":"./lib/helpers","loc":{"line":11,"column":120,"index":838},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\GoTrueClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\lib\\helpers.js"},{"name":"./lib/constants","loc":{"line":12,"column":90,"index":945},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\GoTrueClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\lib\\constants.js"},{"name":"./lib/polyfills","loc":{"line":13,"column":35,"index":999},"parent":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\GoTrueClient.js","resolved":"C:\\Users\\Veeno\\Desktop\\fse\\react-widget\\node_modules\\@supabase\\gotrue-js\\dist\\module\\lib\\polyfills.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=i(require(\"./GoTrueApi\")),r=require(\"./lib/helpers\"),s=require(\"./lib/constants\"),t=require(\"./lib/polyfills\");function i(e){return e&&e.__esModule?e:{default:e}}var n=function(e,r,s,t){return new(s||(s=Promise))(function(i,n){function o(e){try{a(t.next(e))}catch(r){n(r)}}function l(e){try{a(t.throw(e))}catch(r){n(r)}}function a(e){var r;e.done?i(e.value):(r=e.value,r instanceof s?r:new s(function(e){e(r)})).then(o,l)}a((t=t.apply(e,r||[])).next())})};(0,t.polyfillGlobalThis)();const o={url:s.GOTRUE_URL,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:s.DEFAULT_HEADERS};class l{constructor(s){this.stateChangeEmitters=new Map,this.networkRetries=0;const t=Object.assign(Object.assign({},o),s);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=t.autoRefreshToken,this.persistSession=t.persistSession,this.multiTab=t.multiTab,this.localStorage=t.localStorage||globalThis.localStorage,this.api=new e.default({url:t.url,headers:t.headers,cookieOptions:t.cookieOptions,fetch:t.fetch}),this._recoverSession(),this._recoverAndRefresh(),this._listenForMultiTabEvents(),this._handleVisibilityChange(),t.detectSessionInUrl&&(0,r.isBrowser)()&&(0,r.getParameterByName)(\"access_token\")&&this.getSessionFromUrl({storeSession:!0}).then(({error:e})=>{if(e)throw new Error(\"Error getting session from URL.\")})}signUp({email:e,password:r,phone:s},t={}){return n(this,void 0,void 0,function*(){try{this._removeSession();const{data:n,error:o}=s&&r?yield this.api.signUpWithPhone(s,r,{data:t.data,captchaToken:t.captchaToken}):yield this.api.signUpWithEmail(e,r,{redirectTo:t.redirectTo,data:t.data,captchaToken:t.captchaToken});if(o)throw o;if(!n)throw\"An error occurred on sign up.\";let l=null,a=null;return n.access_token&&(a=(l=n).user,this._saveSession(l),this._notifyAllSubscribers(\"SIGNED_IN\")),n.id&&(a=n),{user:a,session:l,error:null}}catch(i){return{user:null,session:null,error:i}}})}signIn({email:e,phone:r,password:s,refreshToken:t,provider:i,oidc:o},l={}){return n(this,void 0,void 0,function*(){try{if(this._removeSession(),e&&!s){const{error:r}=yield this.api.sendMagicLinkEmail(e,{redirectTo:l.redirectTo,shouldCreateUser:l.shouldCreateUser,captchaToken:l.captchaToken});return{user:null,session:null,error:r}}if(e&&s)return this._handleEmailSignIn(e,s,{redirectTo:l.redirectTo,captchaToken:l.captchaToken});if(r&&!s){const{error:e}=yield this.api.sendMobileOTP(r,{shouldCreateUser:l.shouldCreateUser,captchaToken:l.captchaToken});return{user:null,session:null,error:e}}if(r&&s)return this._handlePhoneSignIn(r,s);if(t){const{error:e}=yield this._callRefreshToken(t);if(e)throw e;return{user:this.currentUser,session:this.currentSession,error:null}}if(i)return this._handleProviderSignIn(i,{redirectTo:l.redirectTo,scopes:l.scopes,queryParams:l.queryParams});if(o)return this._handleOpenIDConnectSignIn(o);throw new Error(\"You must provide either an email, phone number, a third-party provider or OpenID Connect.\")}catch(n){return{user:null,session:null,error:n}}})}verifyOTP(e,r={}){return n(this,void 0,void 0,function*(){try{this._removeSession();const{data:t,error:i}=yield this.api.verifyOTP(e,r);if(i)throw i;if(!t)throw\"An error occurred on token verification.\";let n=null,o=null;return t.access_token&&(o=(n=t).user,this._saveSession(n),this._notifyAllSubscribers(\"SIGNED_IN\")),t.id&&(o=t),{user:o,session:n,error:null}}catch(s){return{user:null,session:null,error:s}}})}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var e;return n(this,void 0,void 0,function*(){try{if(!(null===(e=this.currentSession)||void 0===e?void 0:e.access_token))throw new Error(\"Not logged in.\");const{error:s}=yield this._callRefreshToken();if(s)throw s;return{data:this.currentSession,user:this.currentUser,error:null}}catch(r){return{data:null,user:null,error:r}}})}update(e){var r;return n(this,void 0,void 0,function*(){try{if(!(null===(r=this.currentSession)||void 0===r?void 0:r.access_token))throw new Error(\"Not logged in.\");const{user:t,error:i}=yield this.api.updateUser(this.currentSession.access_token,e);if(i)throw i;if(!t)throw Error(\"Invalid user data.\");const n=Object.assign(Object.assign({},this.currentSession),{user:t});return this._saveSession(n),this._notifyAllSubscribers(\"USER_UPDATED\"),{data:t,user:t,error:null}}catch(s){return{data:null,user:null,error:s}}})}setSession(e){return n(this,void 0,void 0,function*(){try{if(!e)throw new Error(\"No current session.\");const{data:s,error:t}=yield this.api.refreshAccessToken(e);return t?{session:null,error:t}:(this._saveSession(s),this._notifyAllSubscribers(\"SIGNED_IN\"),{session:s,error:null})}catch(r){return{error:r,session:null}}})}setAuth(e){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:e,token_type:\"bearer\",user:this.user()}),this._notifyAllSubscribers(\"TOKEN_REFRESHED\"),this.currentSession}getSessionFromUrl(e){return n(this,void 0,void 0,function*(){try{if(!(0,r.isBrowser)())throw new Error(\"No browser detected.\");const t=(0,r.getParameterByName)(\"error_description\");if(t)throw new Error(t);const i=(0,r.getParameterByName)(\"provider_token\"),n=(0,r.getParameterByName)(\"access_token\");if(!n)throw new Error(\"No access_token detected.\");const o=(0,r.getParameterByName)(\"expires_in\");if(!o)throw new Error(\"No expires_in detected.\");const l=(0,r.getParameterByName)(\"refresh_token\");if(!l)throw new Error(\"No refresh_token detected.\");const a=(0,r.getParameterByName)(\"token_type\");if(!a)throw new Error(\"No token_type detected.\");const u=Math.round(Date.now()/1e3)+parseInt(o),{user:c,error:h}=yield this.api.getUser(n);if(h)throw h;const d={provider_token:i,access_token:n,expires_in:parseInt(o),expires_at:u,refresh_token:l,token_type:a,user:c};if(null==e?void 0:e.storeSession){this._saveSession(d);const e=(0,r.getParameterByName)(\"type\");this._notifyAllSubscribers(\"SIGNED_IN\"),\"recovery\"===e&&this._notifyAllSubscribers(\"PASSWORD_RECOVERY\")}return window.location.hash=\"\",{data:d,error:null}}catch(s){return{data:null,error:s}}})}signOut(){var e;return n(this,void 0,void 0,function*(){const r=null===(e=this.currentSession)||void 0===e?void 0:e.access_token;if(this._removeSession(),this._notifyAllSubscribers(\"SIGNED_OUT\"),r){const{error:e}=yield this.api.signOut(r);if(e)return{error:e}}return{error:null}})}onAuthStateChange(e){try{const t=(0,r.uuid)(),i={id:t,callback:e,unsubscribe:()=>{this.stateChangeEmitters.delete(t)}};return this.stateChangeEmitters.set(t,i),{data:i,error:null}}catch(s){return{data:null,error:s}}}_handleEmailSignIn(e,r,s={}){var t,i;return n(this,void 0,void 0,function*(){try{const{data:o,error:l}=yield this.api.signInWithEmail(e,r,{redirectTo:s.redirectTo,captchaToken:s.captchaToken});return l||!o?{data:null,user:null,session:null,error:l}:(((null===(t=null==o?void 0:o.user)||void 0===t?void 0:t.confirmed_at)||(null===(i=null==o?void 0:o.user)||void 0===i?void 0:i.email_confirmed_at))&&(this._saveSession(o),this._notifyAllSubscribers(\"SIGNED_IN\")),{data:o,user:o.user,session:o,error:null})}catch(n){return{data:null,user:null,session:null,error:n}}})}_handlePhoneSignIn(e,r,s={}){var t;return n(this,void 0,void 0,function*(){try{const{data:n,error:o}=yield this.api.signInWithPhone(e,r,s);return o||!n?{data:null,user:null,session:null,error:o}:((null===(t=null==n?void 0:n.user)||void 0===t?void 0:t.phone_confirmed_at)&&(this._saveSession(n),this._notifyAllSubscribers(\"SIGNED_IN\")),{data:n,user:n.user,session:n,error:null})}catch(i){return{data:null,user:null,session:null,error:i}}})}_handleProviderSignIn(e,s={}){const t=this.api.getUrlForProvider(e,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});try{return(0,r.isBrowser)()&&(window.location.href=t),{provider:e,url:t,data:null,session:null,user:null,error:null}}catch(i){return t?{provider:e,url:t,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:i}}}_handleOpenIDConnectSignIn({id_token:e,nonce:r,client_id:s,issuer:t,provider:i}){return n(this,void 0,void 0,function*(){if(e&&r&&(s&&t||i))try{const{data:o,error:l}=yield this.api.signInWithOpenIDConnect({id_token:e,nonce:r,client_id:s,issuer:t,provider:i});return l||!o?{user:null,session:null,error:l}:(this._saveSession(o),this._notifyAllSubscribers(\"SIGNED_IN\"),{user:o.user,session:o,error:null})}catch(n){return{user:null,session:null,error:n}}throw new Error(\"You must provide a OpenID Connect provider with your id token and nonce.\")})}_recoverSession(){try{const t=(0,r.getItemSynchronously)(this.localStorage,s.STORAGE_KEY);if(!t)return null;const{currentSession:i,expiresAt:n}=t;n>=Math.round(Date.now()/1e3)+s.EXPIRY_MARGIN&&(null==i?void 0:i.user)&&(this._saveSession(i),this._notifyAllSubscribers(\"SIGNED_IN\"))}catch(e){console.log(\"error\",e)}}_recoverAndRefresh(){return n(this,void 0,void 0,function*(){try{const t=yield(0,r.getItemAsync)(this.localStorage,s.STORAGE_KEY);if(!t)return null;const{currentSession:i,expiresAt:n}=t;if(n<Math.round(Date.now()/1e3)+s.EXPIRY_MARGIN)if(this.autoRefreshToken&&i.refresh_token){this.networkRetries++;const{error:e}=yield this._callRefreshToken(i.refresh_token);if(e){if(console.log(e.message),e.message===s.NETWORK_FAILURE.ERROR_MESSAGE&&this.networkRetries<s.NETWORK_FAILURE.MAX_RETRIES)return this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),void(this.refreshTokenTimer=setTimeout(()=>this._recoverAndRefresh(),100*Math.pow(s.NETWORK_FAILURE.RETRY_INTERVAL,this.networkRetries)));yield this._removeSession()}this.networkRetries=0}else this._removeSession();else i?(this._saveSession(i),this._notifyAllSubscribers(\"SIGNED_IN\")):(console.log(\"Current session is missing data.\"),this._removeSession())}catch(e){return console.error(e),null}})}_callRefreshToken(e){var r;return void 0===e&&(e=null===(r=this.currentSession)||void 0===r?void 0:r.refresh_token),n(this,void 0,void 0,function*(){try{if(!e)throw new Error(\"No current session.\");const{data:s,error:t}=yield this.api.refreshAccessToken(e);if(t)throw t;if(!s)throw Error(\"Invalid session data.\");return this._saveSession(s),this._notifyAllSubscribers(\"TOKEN_REFRESHED\"),this._notifyAllSubscribers(\"SIGNED_IN\"),{data:s,error:null}}catch(r){return{data:null,error:r}}})}_notifyAllSubscribers(e){this.stateChangeEmitters.forEach(r=>r.callback(e,this.currentSession))}_saveSession(e){this.currentSession=e,this.currentUser=e.user;const r=e.expires_at;if(r){const e=r-Math.round(Date.now()/1e3),t=e>s.EXPIRY_MARGIN?s.EXPIRY_MARGIN:.5;this._startAutoRefreshToken(1e3*(e-t))}this.persistSession&&e.expires_at&&this._persistSession(this.currentSession)}_persistSession(e){const t={currentSession:e,expiresAt:e.expires_at};(0,r.setItemAsync)(this.localStorage,s.STORAGE_KEY,t)}_removeSession(){return n(this,void 0,void 0,function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),(0,r.removeItemAsync)(this.localStorage,s.STORAGE_KEY)})}_startAutoRefreshToken(e){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),e<=0||!this.autoRefreshToken||(this.refreshTokenTimer=setTimeout(()=>n(this,void 0,void 0,function*(){this.networkRetries++;const{error:e}=yield this._callRefreshToken();e||(this.networkRetries=0),(null==e?void 0:e.message)===s.NETWORK_FAILURE.ERROR_MESSAGE&&this.networkRetries<s.NETWORK_FAILURE.MAX_RETRIES&&this._startAutoRefreshToken(100*Math.pow(s.NETWORK_FAILURE.RETRY_INTERVAL,this.networkRetries))}),e),\"function\"==typeof this.refreshTokenTimer.unref&&this.refreshTokenTimer.unref())}_listenForMultiTabEvents(){if(!this.multiTab||!(0,r.isBrowser)()||!(null===window||void 0===window?void 0:window.addEventListener))return!1;try{null===window||void 0===window||window.addEventListener(\"storage\",e=>{var r;if(e.key===s.STORAGE_KEY){const s=JSON.parse(String(e.newValue));(null===(r=null==s?void 0:s.currentSession)||void 0===r?void 0:r.access_token)?(this._saveSession(s.currentSession),this._notifyAllSubscribers(\"SIGNED_IN\")):(this._removeSession(),this._notifyAllSubscribers(\"SIGNED_OUT\"))}})}catch(e){console.error(\"_listenForMultiTabEvents\",e)}}_handleVisibilityChange(){if(!this.multiTab||!(0,r.isBrowser)()||!(null===window||void 0===window?void 0:window.addEventListener))return!1;try{null===window||void 0===window||window.addEventListener(\"visibilitychange\",()=>{\"visible\"===document.visibilityState&&this._recoverAndRefresh()})}catch(e){console.error(\"_handleVisibilityChange\",e)}}}exports.default=l;"},"sourceMaps":null,"error":null,"hash":"43d333a3a71ddc50e96ee97c81b106b8","cacheData":{"env":{}}}